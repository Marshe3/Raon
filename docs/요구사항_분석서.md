# 요구사항 분석서

| 주제명 : | Raon - AI 면접 연습 플랫폼 |
| :---: | :---- |

|        2025. 11. 29.  |
| :---: |

---

## 1. 개요

본 문서는 사용자의 요구사항을 분석하여 데이터베이스 설계를 위한 **테이블(개체)**, **컬럼(속성)**, **관계**를 추출하는 단계입니다.

요구사항 문장에서 데이터베이스에 저장할 가치가 있는 중요한 명사를 찾아내고, 이를 테이블과 컬럼으로 분류합니다.

---

## 2. 사용자 인증 및 관리

### 요구사항 1: 소셜 로그인

**원문**: "사용자는 Google 또는 Kakao 계정으로 OAuth2 로그인을 한다. 최초 로그인 시 소셜 정보를 활용하여 자동으로 회원가입이 처리되며, 사용자 정보(이메일, 닉네임, 프로필 이미지)가 DB에 저장된다."

**추출된 내용**:
- **테이블**: User (사용자)
- **컬럼**: 이메일, 소셜 타입, 소셜 ID, 닉네임, 프로필 이미지, 가입일, 마지막 로그인
- **식별자**: 사용자 ID로 식별한다 (PK)
- **제약조건**: 이메일과 소셜 ID는 중복될 수 없다 (UNIQUE)

---

### 요구사항 2: JWT 토큰 관리

**원문**: "JWT Access Token(1시간)과 Refresh Token(7일)을 발급한다. Refresh Token은 AES 암호화하여 DB에 저장한다."

**추출된 내용**:
- **테이블**: RefreshToken (리프레시 토큰)
- **컬럼**: 토큰 ID, 사용자 ID, 암호화된 토큰, 만료일시
- **식별자**: 토큰 ID로 식별한다 (PK)
- **관계**: 한 사용자는 하나의 Refresh Token을 가진다 (User 1:1 RefreshToken)

---

## 3. 이력서 관리

### 요구사항 3: 이력서 작성

**원문**: "사용자는 이력서를 작성할 수 있다. 이력서는 5단계 탭(기본 정보, 기술/역량, 학력/경력, 자기소개서, 완료)으로 구성되며, 제목, 이름, 전화번호, 이메일, 희망 직무, 기술/역량을 입력한다. 사용자당 최대 5개의 이력서를 작성할 수 있으며, 하나를 기본 이력서로 설정할 수 있다."

**추출된 내용**:
- **테이블**: Resume (이력서)
- **컬럼**: 이력서 ID, 사용자 ID, 제목, 이름, 전화번호, 이메일, 희망 직무, 기술/역량, 기본 이력서 여부
- **식별자**: 이력서 ID로 식별한다 (PK)
- **관계**: 한 사용자는 여러 이력서를 작성할 수 있다 (User 1:N Resume)
- **제약조건**: 사용자당 최대 5개, 기본 이력서는 1개만 설정 가능

---

### 요구사항 4: 학력 정보

**원문**: "이력서에는 학력 정보를 입력한다. 학력 구분, 학교명, 전공, 재학기간, 상태(졸업/재학중/중퇴/수료), 학점을 입력할 수 있다."

**추출된 내용**:
- **테이블**: Education (학력)
- **컬럼**: 학력 ID, 이력서 ID, 학력 구분, 학교명, 전공, 재학기간, 상태, 학점, 정렬 순서
- **식별자**: 학력 ID로 식별한다 (PK)
- **관계**: 한 이력서는 여러 학력 정보를 포함한다 (Resume 1:N Education)
- **삭제 규칙**: 이력서 삭제 시 학력 정보도 함께 삭제된다 (CASCADE)

---

### 요구사항 5: 경력 정보

**원문**: "이력서에는 경력 정보를 입력한다. 회사명, 직무/직책, 근무기간, 재직중 여부, 담당업무, 성과를 입력할 수 있다."

**추출된 내용**:
- **테이블**: Career (경력)
- **컬럼**: 경력 ID, 이력서 ID, 회사명, 직무/직책, 근무기간, 재직중 여부, 담당업무, 성과, 정렬 순서
- **식별자**: 경력 ID로 식별한다 (PK)
- **관계**: 한 이력서는 여러 경력 정보를 포함한다 (Resume 1:N Career)
- **삭제 규칙**: 이력서 삭제 시 경력 정보도 함께 삭제된다 (CASCADE)

---

## 4. 자기소개서 관리

### 요구사항 6: 자기소개서 작성

**원문**: "사용자는 자기소개서를 작성할 수 있다. 제목, 내용, 지원 회사, 지원 직무를 입력한다. 사용자당 최대 5개의 자소서를 작성할 수 있으며, 하나를 기본 자소서로 설정할 수 있다."

**추출된 내용**:
- **테이블**: CoverLetter (자기소개서)
- **컬럼**: 자소서 ID, 사용자 ID, 제목, 내용, 지원 회사, 지원 직무, 기본 자소서 여부
- **식별자**: 자소서 ID로 식별한다 (PK)
- **관계**: 한 사용자는 여러 자소서를 작성할 수 있다 (User 1:N CoverLetter)
- **제약조건**: 사용자당 최대 5개, 기본 자소서는 1개만 설정 가능

---

## 5. AI 챗봇 면접

### 요구사항 7: 챗봇 설정

**원문**: "AI 면접관 아바타(챗봇)는 이름, 설명, 모델 스타일, TTS 타입, LLM 타입, STT 타입, PersoAI 프롬프트 ID, 문서 ID를 가진다. 활성화 여부와 공개 여부로 관리된다."

**추출된 내용**:
- **테이블**: Chatbot (챗봇)
- **컬럼**: 챗봇 ID, 챗봇 이름, 설명, 모델 스타일, TTS 타입, LLM 타입, STT 타입, 프롬프트 ID, 문서 ID, 활성화 여부, 공개 여부
- **식별자**: 챗봇 ID로 식별한다 (PK)
- **관계**: 독립적인 개체 (다른 테이블과 직접적인 관계 없음)

---

### 요구사항 8: 채팅방 및 메시지

**원문**: "사용자는 AI 아바타와 채팅방을 통해 대화한다. 채팅방은 PersoAI 세션 ID로 식별되며, 메시지는 발신자 역할(user/assistant/system)과 내용으로 구성된다. 대화 내용은 실시간으로 DB에 저장된다."

**추출된 내용**:
- **테이블 1**: ChatRoom (채팅방)
  - **컬럼**: 채팅방 ID, PersoAI 세션 ID
  - **식별자**: 채팅방 ID로 식별한다 (PK)
  - **제약조건**: PersoAI 세션 ID는 중복될 수 없다 (UNIQUE)

- **테이블 2**: Message (메시지)
  - **컬럼**: 메시지 ID, 채팅방 ID, 역할, 내용, 전송 일시
  - **식별자**: 메시지 ID로 식별한다 (PK)
  - **관계**: 한 채팅방은 여러 메시지를 포함한다 (ChatRoom 1:N Message)
  - **삭제 규칙**: 채팅방 삭제 시 메시지도 함께 삭제된다 (CASCADE)

---

## 6. 면접 피드백 및 학습 기록

### 요구사항 9: 면접 피드백 저장

**원문**: "사용자가 AI 아바타와 면접 연습을 완료하면 Gemini AI로부터 피드백(점수, 5개 섹션별 평가)을 받는다. 시스템은 면접 점수, 피드백 전체 JSON, 면접 종류(아바타명 기반), 면접 일시를 DB에 자동 저장한다."

**추출된 내용**:
- **테이블**: InterviewFeedback (면접 피드백)
- **컬럼**: 피드백 ID, 사용자 ID, 채팅방 ID, 점수, 피드백 요약(JSON), 면접 종류, 면접 일시
- **식별자**: 피드백 ID로 식별한다 (PK)
- **관계**:
  - 한 사용자는 여러 면접 피드백 기록을 가진다 (User 1:N InterviewFeedback)
  - 한 채팅방은 하나의 피드백 기록을 가질 수 있다 (ChatRoom 1:1 InterviewFeedback, 선택적)
- **제약조건**: 점수는 0.00 ~ 100.00 범위

---

### 요구사항 10: 학습 기록 조회

**원문**: "사용자는 학습 기록 페이지에서 면접 종류별로 필터링하여 면접 이력을 조회하고, 시간대별 점수 변화를 그래프로 확인하며, 성장도를 분석할 수 있다."

**추출된 내용**:
- **활용 테이블**: InterviewFeedback
- **조회 조건**: 사용자 ID, 면접 종류, 기간별 필터링
- **정렬 기준**: 면접 일시 (시간순)
- **집계 데이터**: 평균 점수, 최고 점수, 최근 추세

---

## 7. 전체 관계 요약

```
1. User (사용자)
   ├─ 1:1 ─ RefreshToken (리프레시 토큰)
   ├─ 1:N ─ Resume (이력서)
   │         ├─ 1:N ─ Education (학력)
   │         └─ 1:N ─ Career (경력)
   ├─ 1:N ─ CoverLetter (자기소개서)
   └─ 1:N ─ InterviewFeedback (면접 피드백)

2. ChatRoom (채팅방)
   ├─ 1:N ─ Message (메시지)
   └─ 1:1 ─ InterviewFeedback (면접 피드백) [선택적]

3. Chatbot (챗봇) - 독립 개체
```

---

## 8. 추출된 테이블 목록

| 번호 | 테이블명 | 한글명 | 주요 목적 |
|------|----------|--------|-----------|
| 1 | User | 사용자 | 소셜 로그인 사용자 정보 관리 |
| 2 | RefreshToken | 리프레시 토큰 | JWT 토큰 기반 세션 관리 |
| 3 | Resume | 이력서 | 사용자 이력서 정보 저장 |
| 4 | Education | 학력 | 이력서의 학력 정보 저장 |
| 5 | Career | 경력 | 이력서의 경력 정보 저장 |
| 6 | CoverLetter | 자기소개서 | 사용자 자소서 저장 및 AI 첨삭용 |
| 7 | Chatbot | 챗봇 | AI 면접관 아바타 설정 관리 |
| 8 | ChatRoom | 채팅방 | PersoAI 세션 기반 대화 관리 |
| 9 | Message | 메시지 | 채팅방의 개별 메시지 저장 |
| 10 | InterviewFeedback | 면접 피드백 | 면접 결과 및 학습 성장도 추적 |

---

## 9. 주요 제약조건 및 비즈니스 규칙

| 테이블 | 제약조건 | 설명 |
|--------|----------|------|
| User | email UNIQUE | 이메일 중복 불가 |
| User | social_id UNIQUE | 소셜 ID 중복 불가 |
| User | deletedAt (소프트 삭제) | 회원 탈퇴 시 데이터 유지, deletedAt만 설정 |
| RefreshToken | user_id UNIQUE | 사용자당 1개의 토큰만 보유 |
| Resume | 사용자당 최대 5개 | 비즈니스 로직으로 검증 |
| Resume | 기본 이력서 1개 | is_default 플래그, 사용자당 1개만 TRUE |
| CoverLetter | 사용자당 최대 5개 | 비즈니스 로직으로 검증 |
| CoverLetter | 기본 자소서 1개 | is_default 플래그, 사용자당 1개만 TRUE |
| ChatRoom | perso_session_id UNIQUE | PersoAI 세션 ID 중복 불가 |
| InterviewFeedback | score 범위 | 0.00 ~ 100.00 (DECIMAL 5,2) |

---

## 10. CASCADE 삭제 규칙

| 부모 테이블 | 자식 테이블 | 삭제 규칙 | 설명 |
|------------|------------|-----------|------|
| User | RefreshToken | CASCADE | 사용자 삭제 시 토큰도 삭제 (실제로는 User가 소프트 삭제) |
| Resume | Education | CASCADE | 이력서 삭제 시 학력 정보도 삭제 |
| Resume | Career | CASCADE | 이력서 삭제 시 경력 정보도 삭제 |
| ChatRoom | Message | CASCADE | 채팅방 삭제 시 메시지도 삭제 |
| ChatRoom | InterviewFeedback | SET NULL | 채팅방 삭제 시 피드백의 chat_id를 NULL로 설정 |

---

**문서 작성일**: 2025.11.29
**작성자**: Claude
**버전**: 1.0

---

## 참고 문서
- [프로젝트_요구사항_정의서.md](./프로젝트_요구사항_정의서.md)
- [테이블_명세서.md](./테이블_명세서.md)
