| 테이블 명세서 |
| :---: |

| 주제명 : | Raon - AI 면접 연습 플랫폼 |
| :---: | :---- |

|        2025\. 11\. 27\.  |
| :---: |

---

## 목차

1. [사용자 관련 테이블](#1-사용자-관련-테이블)
   - [user (사용자)](#11-user-사용자)
   - [refresh_tokens (리프레시 토큰)](#12-refresh_tokens-리프레시-토큰)

2. [이력서 관련 테이블](#2-이력서-관련-테이블)
   - [resume (이력서)](#21-resume-이력서)
   - [education (학력)](#22-education-학력)
   - [career (경력)](#23-career-경력)

3. [자기소개서 테이블](#3-자기소개서-테이블)
   - [cover_letter (자기소개서)](#31-cover_letter-자기소개서)

4. [챗봇 관련 테이블](#4-챗봇-관련-테이블)
   - [chatbot (챗봇)](#41-chatbot-챗봇)
   - [chat_room (채팅방)](#42-chat_room-채팅방)
   - [message (메시지)](#43-message-메시지)

5. [학습 기록 테이블](#5-학습-기록-테이블)
   - [interview_feedback (면접 피드백)](#51-interview_feedback-면접-피드백)

6. [ERD (Entity Relationship Diagram)](#6-erd-entity-relationship-diagram)

---

## 1. 사용자 관련 테이블

### 1.1. user (사용자)

**테이블 설명**: 소셜 로그인을 통해 가입한 사용자 정보를 저장하는 테이블

| 컬럼명 | 한글명 | 데이터 타입 | 길이 | NULL | 기본값 | 제약조건 | 설명 |
|--------|--------|-------------|------|------|--------|----------|------|
| user_id | 사용자 ID | BIGINT | - | N | AUTO_INCREMENT | PK | 사용자 고유 식별자 |
| email | 이메일 | VARCHAR | 100 | Y | - | UNIQUE | 사용자 이메일 주소 |
| social_type | 소셜 타입 | VARCHAR | 20 | N | - | - | 소셜 로그인 유형 (KAKAO, GOOGLE) |
| social_id | 소셜 ID | VARCHAR | 255 | N | - | UNIQUE | 소셜 제공자 고유 식별자 |
| nickname | 닉네임 | VARCHAR | 50 | Y | - | - | 사용자 닉네임 |
| profile_image | 프로필 이미지 | VARCHAR | 500 | Y | - | - | 프로필 이미지 URL |
| join_date | 가입일 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 회원 가입 일시 |
| last_login | 마지막 로그인 | DATETIME | - | N | - | - | 최근 접속 시간 |
| deleted_at | 탈퇴일 | DATETIME | - | Y | NULL | - | 회원 탈퇴 일시 (소프트 삭제) |
| created_at | 생성일시 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 레코드 생성 일시 |
| updated_at | 수정일시 | DATETIME | - | N | CURRENT_TIMESTAMP | ON UPDATE | 레코드 최종 수정 일시 |

**인덱스**:
- PRIMARY KEY: `user_id`
- UNIQUE INDEX: `email`
- UNIQUE INDEX: `social_id`

**비즈니스 규칙**:
- 소셜 로그인만 지원 (Google, Kakao)
- 탈퇴 시 `deleted_at`에 날짜 기록 (소프트 삭제)
- 이메일과 소셜 ID는 중복 불가

---

### 1.2. refresh_tokens (리프레시 토큰)

**테이블 설명**: JWT Refresh Token을 저장하여 사용자 세션을 관리하는 테이블

| 컬럼명 | 한글명 | 데이터 타입 | 길이 | NULL | 기본값 | 제약조건 | 설명 |
|--------|--------|-------------|------|------|--------|----------|------|
| id | 토큰 ID | BIGINT | - | N | AUTO_INCREMENT | PK | 토큰 고유 식별자 |
| user_id | 사용자 ID | BIGINT | - | N | - | UNIQUE | 사용자 고유 번호 |
| token | 토큰 | VARCHAR | 500 | N | - | - | AES 암호화된 Refresh Token |
| expires_at | 만료일시 | DATETIME | - | N | - | - | 토큰 만료 일시 |
| created_at | 생성일시 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 토큰 생성 일시 |

**인덱스**:
- PRIMARY KEY: `id`
- UNIQUE INDEX: `user_id`

**비즈니스 규칙**:
- 사용자당 1개의 Refresh Token만 보유
- 토큰은 AES 암호화하여 저장
- Refresh Token 유효 기간: 7일
- 앱 시작 시 만료된 토큰 자동 삭제

---

## 2. 이력서 관련 테이블

### 2.1. resume (이력서)

**테이블 설명**: 사용자가 작성한 이력서 정보를 저장하는 테이블

| 컬럼명 | 한글명 | 데이터 타입 | 길이 | NULL | 기본값 | 제약조건 | 설명 |
|--------|--------|-------------|------|------|--------|----------|------|
| resume_id | 이력서 ID | BIGINT | - | N | AUTO_INCREMENT | PK | 이력서 고유 식별자 |
| user_id | 사용자 ID | BIGINT | - | N | - | FK | 이력서 작성자 (user.user_id) |
| title | 제목 | VARCHAR | 100 | N | - | - | 이력서 제목 |
| name | 이름 | VARCHAR | 50 | N | - | - | 지원자 이름 |
| phone | 연락처 | VARCHAR | 20 | Y | - | - | 전화번호 |
| email | 이메일 | VARCHAR | 100 | Y | - | - | 이메일 주소 |
| desired_position | 희망 직무 | VARCHAR | 100 | Y | - | - | 지원 희망 직무 |
| skills | 기술/역량 | TEXT | - | Y | - | - | 보유 기술 및 역량 |
| is_default | 기본 이력서 여부 | BOOLEAN | - | N | FALSE | - | 기본 이력서 설정 여부 |
| created_at | 생성일시 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 이력서 생성 일시 |
| updated_at | 수정일시 | DATETIME | - | N | CURRENT_TIMESTAMP | ON UPDATE | 이력서 최종 수정 일시 |

**인덱스**:
- PRIMARY KEY: `resume_id`
- FOREIGN KEY: `user_id` REFERENCES `user(user_id)`
- INDEX: `user_id`

**비즈니스 규칙**:
- 사용자당 최대 5개 이력서 작성 가능
- 기본 이력서는 사용자당 1개만 설정 가능
- 이력서 삭제 시 연관된 학력/경력 자동 삭제 (CASCADE)

---

### 2.2. education (학력)

**테이블 설명**: 이력서의 학력 정보를 저장하는 테이블

| 컬럼명 | 한글명 | 데이터 타입 | 길이 | NULL | 기본값 | 제약조건 | 설명 |
|--------|--------|-------------|------|------|--------|----------|------|
| education_id | 학력 ID | BIGINT | - | N | AUTO_INCREMENT | PK | 학력 고유 식별자 |
| resume_id | 이력서 ID | BIGINT | - | N | - | FK | 소속 이력서 (resume.resume_id) |
| education_type | 학력 구분 | VARCHAR | 50 | N | - | - | 고등학교/대학교/대학원 등 |
| school_name | 학교명 | VARCHAR | 100 | N | - | - | 학교 이름 |
| major | 전공 | VARCHAR | 100 | Y | - | - | 전공 분야 (고졸의 경우 NULL 가능) |
| attendance_period | 재학기간 | VARCHAR | 50 | Y | - | - | 재학 기간 (예: 2018.03 ~ 2022.02) |
| status | 상태 | VARCHAR | 20 | Y | - | - | 졸업/재학중/중퇴/수료 |
| gpa | 학점 | VARCHAR | 20 | Y | - | - | 학점 정보 (예: 4.0/4.5) |
| order_index | 정렬 순서 | INT | - | N | 0 | - | 여러 학력 정렬용 인덱스 |
| created_at | 생성일시 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 레코드 생성 일시 |
| updated_at | 수정일시 | DATETIME | - | N | CURRENT_TIMESTAMP | ON UPDATE | 레코드 최종 수정 일시 |

**인덱스**:
- PRIMARY KEY: `education_id`
- FOREIGN KEY: `resume_id` REFERENCES `resume(resume_id)` ON DELETE CASCADE
- INDEX: `resume_id`

**비즈니스 규칙**:
- 하나의 이력서에 여러 학력 정보 등록 가능
- `order_index`로 표시 순서 제어
- 이력서 삭제 시 함께 삭제 (CASCADE)

---

### 2.3. career (경력)

**테이블 설명**: 이력서의 경력 정보를 저장하는 테이블

| 컬럼명 | 한글명 | 데이터 타입 | 길이 | NULL | 기본값 | 제약조건 | 설명 |
|--------|--------|-------------|------|------|--------|----------|------|
| career_id | 경력 ID | BIGINT | - | N | AUTO_INCREMENT | PK | 경력 고유 식별자 |
| resume_id | 이력서 ID | BIGINT | - | N | - | FK | 소속 이력서 (resume.resume_id) |
| company_name | 회사명 | VARCHAR | 100 | N | - | - | 근무 회사 이름 |
| position | 직무/직책 | VARCHAR | 100 | N | - | - | 담당 직무 또는 직책 |
| employment_period | 근무기간 | VARCHAR | 50 | Y | - | - | 근무 기간 (예: 2020.03 ~ 2022.12) |
| is_current | 재직중 여부 | BOOLEAN | - | N | FALSE | - | 현재 재직중인지 여부 |
| responsibilities | 담당업무 | TEXT | - | Y | - | - | 주요 담당 업무 상세 설명 |
| achievements | 성과 | TEXT | - | Y | - | - | 업무 성과 및 기여도 |
| order_index | 정렬 순서 | INT | - | N | 0 | - | 여러 경력 정렬용 인덱스 |
| created_at | 생성일시 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 레코드 생성 일시 |
| updated_at | 수정일시 | DATETIME | - | N | CURRENT_TIMESTAMP | ON UPDATE | 레코드 최종 수정 일시 |

**인덱스**:
- PRIMARY KEY: `career_id`
- FOREIGN KEY: `resume_id` REFERENCES `resume(resume_id)` ON DELETE CASCADE
- INDEX: `resume_id`

**비즈니스 규칙**:
- 하나의 이력서에 여러 경력 정보 등록 가능
- `order_index`로 표시 순서 제어 (최신순 권장)
- `is_current = TRUE`인 경우 현재 재직중
- 이력서 삭제 시 함께 삭제 (CASCADE)

---

## 3. 자기소개서 테이블

### 3.1. cover_letter (자기소개서)

**테이블 설명**: 사용자가 작성한 자기소개서를 저장하는 테이블

| 컬럼명 | 한글명 | 데이터 타입 | 길이 | NULL | 기본값 | 제약조건 | 설명 |
|--------|--------|-------------|------|------|--------|----------|------|
| cover_letter_id | 자소서 ID | BIGINT | - | N | AUTO_INCREMENT | PK | 자소서 고유 식별자 |
| user_id | 사용자 ID | BIGINT | - | N | - | FK | 자소서 작성자 (user.user_id) |
| title | 제목 | VARCHAR | 100 | N | - | - | 자소서 제목 |
| content | 내용 | TEXT | - | N | - | - | 자소서 본문 내용 |
| company_name | 지원 회사 | VARCHAR | 100 | Y | - | - | 지원 대상 회사명 (참고용) |
| position | 지원 직무 | VARCHAR | 100 | Y | - | - | 지원 희망 직무 (참고용) |
| is_default | 기본 자소서 여부 | BOOLEAN | - | N | FALSE | - | 기본 자소서 설정 여부 |
| created_at | 생성일시 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 자소서 생성 일시 |
| updated_at | 수정일시 | DATETIME | - | N | CURRENT_TIMESTAMP | ON UPDATE | 자소서 최종 수정 일시 |

**인덱스**:
- PRIMARY KEY: `cover_letter_id`
- FOREIGN KEY: `user_id` REFERENCES `user(user_id)`
- INDEX: `user_id`

**비즈니스 규칙**:
- 사용자당 최대 5개 자소서 작성 가능
- 기본 자소서는 사용자당 1개만 설정 가능
- AI 첨삭 기능 연동 (Google Gemini API)

---

## 4. 챗봇 관련 테이블

### 4.1. chatbot (챗봇)

**테이블 설명**: AI 면접관 아바타(챗봇) 설정 정보를 저장하는 테이블

| 컬럼명 | 한글명 | 데이터 타입 | 길이 | NULL | 기본값 | 제약조건 | 설명 |
|--------|--------|-------------|------|------|--------|----------|------|
| chatbot_id | 챗봇 ID | BIGINT | - | N | AUTO_INCREMENT | PK | 챗봇 고유 식별자 |
| chatbot_name | 챗봇 이름 | VARCHAR | 100 | N | - | - | 챗봇(면접관) 이름 |
| description | 설명 | TEXT | - | Y | - | - | 챗봇 설명 |
| model_style | 모델 스타일 | VARCHAR | 50 | Y | - | - | 챗봇 대화 스타일 |
| tts_type | TTS 타입 | VARCHAR | 50 | Y | - | - | 음성 합성 모델 (예: k_idol_m_2_zino) |
| llm_type | LLM 타입 | VARCHAR | 50 | Y | - | - | 언어 모델 (예: azure-gpt-4o) |
| stt_type | STT 타입 | VARCHAR | 50 | Y | - | - | 음성 인식 모델 (예: whisper) |
| prompt_id | 프롬프트 ID | VARCHAR | 100 | Y | - | - | PersoAI 프롬프트 ID (plp-*) |
| document_id | 문서 ID | VARCHAR | 100 | Y | - | - | PersoAI 문서 ID (pld-*) |
| is_active | 활성화 여부 | BOOLEAN | - | N | TRUE | - | 챗봇 활성화 상태 |
| is_public | 공개 여부 | BOOLEAN | - | N | TRUE | - | 공개 챗봇 여부 |
| created_at | 생성일시 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 챗봇 등록 일시 |
| updated_at | 수정일시 | DATETIME | - | N | CURRENT_TIMESTAMP | ON UPDATE | 챗봇 정보 최종 수정 일시 |

**인덱스**:
- PRIMARY KEY: `chatbot_id`
- INDEX: `is_active, is_public`

**비즈니스 규칙**:
- `is_active = TRUE`인 챗봇만 사용 가능
- `is_public = TRUE`인 챗봇은 모든 사용자가 이용 가능
- PersoAI API와 연동하여 실시간 AI 대화 제공

---

### 4.2. chat_room (채팅방)

**테이블 설명**: AI 챗봇과의 대화 세션(채팅방)을 관리하는 테이블

| 컬럼명 | 한글명 | 데이터 타입 | 길이 | NULL | 기본값 | 제약조건 | 설명 |
|--------|--------|-------------|------|------|--------|----------|------|
| chat_id | 채팅방 ID | BIGINT | - | N | AUTO_INCREMENT | PK | 채팅방 고유 식별자 |
| perso_session_id | PersoAI 세션 ID | VARCHAR | 255 | N | - | UNIQUE | PersoAI API 세션 식별자 |
| created_at | 생성일시 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 채팅방 생성 일시 |

**인덱스**:
- PRIMARY KEY: `chat_id`
- UNIQUE INDEX: `perso_session_id`

**비즈니스 규칙**:
- PersoAI 세션 ID와 1:1 매핑
- 대화 내역 복원을 위한 세션 관리
- 세션 종료 후 재연결 시 기존 대화 복원 가능

---

### 4.3. message (메시지)

**테이블 설명**: 채팅방의 개별 메시지를 저장하는 테이블

| 컬럼명 | 한글명 | 데이터 타입 | 길이 | NULL | 기본값 | 제약조건 | 설명 |
|--------|--------|-------------|------|------|--------|----------|------|
| message_id | 메시지 ID | BIGINT | - | N | AUTO_INCREMENT | PK | 메시지 고유 식별자 |
| chat_id | 채팅방 ID | BIGINT | - | N | - | FK | 소속 채팅방 (chat_room.chat_id) |
| role | 역할 | VARCHAR | 20 | N | - | - | 메시지 발신자 (user/assistant/system) |
| content | 내용 | TEXT | - | N | - | - | 메시지 본문 |
| created_at | 생성일시 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 메시지 전송 일시 |

**인덱스**:
- PRIMARY KEY: `message_id`
- FOREIGN KEY: `chat_id` REFERENCES `chat_room(chat_id)` ON DELETE CASCADE
- INDEX: `idx_chat_id` (`chat_id`)
- INDEX: `idx_created_at` (`created_at`)

**비즈니스 규칙**:
- `role = 'user'`: 사용자가 보낸 메시지
- `role = 'assistant'`: AI 챗봇이 보낸 메시지
- `role = 'system'`: 시스템 메시지
- 채팅방 삭제 시 메시지도 함께 삭제 (CASCADE)
- 대화 내역 검색 기능 제공

---

## 5. 학습 기록 테이블

### 5.1. interview_feedback (면접 피드백)

**테이블 설명**: AI 면접 연습 후 받은 피드백 점수와 요약을 저장하여 학습 성장도를 추적하는 테이블

| 컬럼명 | 한글명 | 데이터 타입 | 길이 | NULL | 기본값 | 제약조건 | 설명 |
|--------|--------|-------------|------|------|--------|----------|------|
| feedback_id | 피드백 ID | BIGINT | - | N | AUTO_INCREMENT | PK | 피드백 고유 식별자 |
| user_id | 사용자 ID | BIGINT | - | N | - | FK | 면접 연습자 (user.user_id) |
| chat_id | 채팅방 ID | BIGINT | - | Y | - | FK | 관련 채팅방 (chat_room.chat_id) |
| score | 점수 | DECIMAL | (5,2) | N | - | - | 면접 평가 점수 (0.00 ~ 100.00) |
| feedback_summary | 피드백 요약 | TEXT | - | Y | - | - | AI 피드백 전체 JSON 내용 (5개 섹션별 평가) |
| interview_type | 면접 종류 | VARCHAR | 100 | Y | '일반 면접' | - | 면접 유형 (백엔드 개발자, 게임 개발자 등) |
| interview_date | 면접 일시 | DATETIME | - | N | - | - | 면접 실시 일시 |
| created_at | 생성일시 | DATETIME | - | N | CURRENT_TIMESTAMP | - | 피드백 저장 일시 |

**인덱스**:
- PRIMARY KEY: `feedback_id`
- FOREIGN KEY: `user_id` REFERENCES `user(user_id)`
- FOREIGN KEY: `chat_id` REFERENCES `chat_room(chat_id)` ON DELETE SET NULL
- INDEX: `idx_user_id` (`user_id`)
- INDEX: `idx_interview_date` (`interview_date`)
- INDEX: `idx_user_interview` (`user_id`, `interview_date`) (복합 인덱스)
- INDEX: `idx_interview_type` (`interview_type`) (면접 종류별 조회용)

**비즈니스 규칙**:
- 면접 완료 시 Gemini AI 피드백 점수와 요약 자동 저장
- 점수 범위: 0.00 ~ 100.00 (소수점 2자리)
- `feedback_summary`는 5개 섹션별 평가를 포함한 전체 JSON 형식
  - 섹션: 적합성, 구체성, 논리성, 진정성, 차별성
  - 각 섹션별 점수, 기준, 피드백 포함
- `interview_type`은 챗봇 아바타 이름 기반 자동 설정 (예: "백엔드 개발자", "게임 개발자")
- `chat_id`는 선택적 (채팅방 삭제 시 NULL 설정)
- 학습 기록 페이지에서 시간대별 점수 추이 그래프 제공
- 기간별 필터링 지원 (전체/1개월/3개월/6개월)
- **면접 종류별 필터링 지원** (interviewType 기반)
- 성장도 분석: 평균 점수, 최고 점수, 최근 추세 계산

**그래프 시각화 데이터**:
- X축: `interview_date` (면접 일시)
- Y축: `score` (면접 점수)
- 추세선: 점수 증감 추이 표시
- 면접 종류별 색상 구분 (interviewType 기반)

**통계 쿼리 예시**:
```sql
-- 최근 1개월 평균 점수
SELECT AVG(score) FROM interview_feedback
WHERE user_id = ? AND interview_date >= DATE_SUB(NOW(), INTERVAL 1 MONTH);

-- 최고 점수
SELECT MAX(score) FROM interview_feedback WHERE user_id = ?;

-- 시간대별 점수 추이 (그래프용)
SELECT interview_date, score, interview_type FROM interview_feedback
WHERE user_id = ? ORDER BY interview_date ASC;

-- 면접 종류별 평균 점수
SELECT interview_type, AVG(score) as avg_score, COUNT(*) as count
FROM interview_feedback
WHERE user_id = ?
GROUP BY interview_type
ORDER BY avg_score DESC;

-- 특정 면접 종류의 점수 추이
SELECT interview_date, score FROM interview_feedback
WHERE user_id = ? AND interview_type = '백엔드 개발자'
ORDER BY interview_date ASC;
```

---

## 6. ERD (Entity Relationship Diagram)

### 6.1. 관계 요약

```
user (1) ──────< (N) resume
                     │
                     ├──< (N) education
                     └──< (N) career

user (1) ──────< (N) cover_letter

user (1) ──────  (1) refresh_tokens

user (1) ──────< (N) interview_feedback

chat_room (1) ──────< (N) message
          └──────  (1) interview_feedback (선택적)

chatbot (독립 엔티티)
```

### 6.2. 관계 상세

| 부모 테이블 | 관계 | 자식 테이블 | 관계 유형 | 설명 |
|------------|------|------------|-----------|------|
| user | 1:N | resume | One-to-Many | 사용자는 여러 이력서 작성 가능 (최대 5개) |
| resume | 1:N | education | One-to-Many | 이력서는 여러 학력 정보 포함 |
| resume | 1:N | career | One-to-Many | 이력서는 여러 경력 정보 포함 |
| user | 1:N | cover_letter | One-to-Many | 사용자는 여러 자소서 작성 가능 (최대 5개) |
| user | 1:1 | refresh_tokens | One-to-One | 사용자당 1개의 Refresh Token |
| user | 1:N | interview_feedback | One-to-Many | 사용자는 여러 면접 피드백 기록 보유 |
| chat_room | 1:N | message | One-to-Many | 채팅방은 여러 메시지 포함 |
| chat_room | 1:1 | interview_feedback | One-to-One (선택적) | 채팅방은 하나의 피드백 기록 보유 가능 |

### 6.3. Cascade 삭제 규칙

- `resume` 삭제 → `education`, `career` 자동 삭제
- `chat_room` 삭제 → `message` 자동 삭제, `interview_feedback.chat_id` → NULL 설정
- `user` 삭제 → 소프트 삭제 (`deleted_at` 설정), 연관 데이터는 유지

---

## 7. 데이터베이스 설정

### 7.1. 기본 설정

| 항목 | 값 |
|------|-----|
| DBMS | MySQL 8.0 |
| 문자셋 | UTF-8 (utf8mb4) |
| Collation | utf8mb4_unicode_ci |
| 타임존 | Asia/Seoul |
| 스토리지 엔진 | InnoDB |

### 7.2. 네이밍 규칙

- **테이블명**: snake_case (소문자 + 언더스코어)
- **컬럼명**: snake_case (소문자 + 언더스코어)
- **PK 컬럼**: `{테이블명}_id` (예: user_id, resume_id)
- **FK 컬럼**: 참조 테이블의 PK명과 동일
- **Boolean 컬럼**: `is_*` 접두사 사용 (예: is_default, is_active)

### 7.3. 공통 컬럼

대부분의 테이블에 포함되는 공통 컬럼:
- `created_at`: 레코드 생성 일시 (자동 설정, 수정 불가)
- `updated_at`: 레코드 최종 수정 일시 (자동 갱신)

---

## 8. 인덱스 전략

### 8.1. 기본 인덱스

모든 테이블:
- PRIMARY KEY 자동 인덱싱

### 8.2. 외래 키 인덱스

외래 키가 있는 컬럼에 인덱스 생성:
- `resume.user_id`
- `education.resume_id`
- `career.resume_id`
- `cover_letter.user_id`
- `message.chat_id`
- `interview_feedback.user_id`
- `interview_feedback.chat_id`

### 8.3. 검색 성능 인덱스

- `user.email` (UNIQUE)
- `user.social_id` (UNIQUE)
- `refresh_tokens.user_id` (UNIQUE)
- `chat_room.perso_session_id` (UNIQUE)
- `message.created_at` (시간순 조회)
- `interview_feedback.interview_date` (시간순 조회, 그래프용)
- `interview_feedback.user_id, interview_date` (복합 인덱스 - 사용자별 시간대별 조회)

---

## 9. 제약조건 및 비즈니스 규칙

### 9.1. 데이터 무결성 제약

| 테이블 | 제약조건 | 설명 |
|--------|----------|------|
| user | email UNIQUE | 이메일 중복 불가 |
| user | social_id UNIQUE | 소셜 ID 중복 불가 |
| refresh_tokens | user_id UNIQUE | 사용자당 1개 토큰 |
| chat_room | perso_session_id UNIQUE | PersoAI 세션 ID 중복 불가 |

### 9.2. 비즈니스 규칙

| 항목 | 규칙 |
|------|------|
| 이력서 개수 | 사용자당 최대 5개 |
| 자소서 개수 | 사용자당 최대 5개 |
| 기본 이력서 | 사용자당 1개만 설정 가능 |
| 기본 자소서 | 사용자당 1개만 설정 가능 |
| Refresh Token | 사용자당 1개, 7일 유효 |
| 소프트 삭제 | user.deleted_at에 날짜 기록 |
| 면접 피드백 점수 | 0.00 ~ 100.00 범위 (소수점 2자리) |
| 학습 기록 기간 필터 | 전체/1개월/3개월/6개월 지원 |

---

## 10. 테이블 생성 스크립트 (DDL)

### 10.1. user (사용자)

```sql
CREATE TABLE `user` (
  `user_id` BIGINT NOT NULL AUTO_INCREMENT,
  `email` VARCHAR(100) DEFAULT NULL,
  `social_type` VARCHAR(20) NOT NULL,
  `social_id` VARCHAR(255) NOT NULL,
  `nickname` VARCHAR(50) DEFAULT NULL,
  `profile_image` VARCHAR(500) DEFAULT NULL,
  `join_date` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `last_login` DATETIME NOT NULL,
  `deleted_at` DATETIME DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`user_id`),
  UNIQUE KEY `uk_email` (`email`),
  UNIQUE KEY `uk_social_id` (`social_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 10.2. refresh_tokens (리프레시 토큰)

```sql
CREATE TABLE `refresh_tokens` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL,
  `token` VARCHAR(500) NOT NULL,
  `expires_at` DATETIME NOT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 10.3. resume (이력서)

```sql
CREATE TABLE `resume` (
  `resume_id` BIGINT NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL,
  `title` VARCHAR(100) NOT NULL,
  `name` VARCHAR(50) NOT NULL,
  `phone` VARCHAR(20) DEFAULT NULL,
  `email` VARCHAR(100) DEFAULT NULL,
  `desired_position` VARCHAR(100) DEFAULT NULL,
  `skills` TEXT DEFAULT NULL,
  `is_default` BOOLEAN NOT NULL DEFAULT FALSE,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`resume_id`),
  KEY `idx_user_id` (`user_id`),
  CONSTRAINT `fk_resume_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 10.4. education (학력)

```sql
CREATE TABLE `education` (
  `education_id` BIGINT NOT NULL AUTO_INCREMENT,
  `resume_id` BIGINT NOT NULL,
  `education_type` VARCHAR(50) NOT NULL,
  `school_name` VARCHAR(100) NOT NULL,
  `major` VARCHAR(100) DEFAULT NULL,
  `attendance_period` VARCHAR(50) DEFAULT NULL,
  `status` VARCHAR(20) DEFAULT NULL,
  `gpa` VARCHAR(20) DEFAULT NULL,
  `order_index` INT NOT NULL DEFAULT 0,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`education_id`),
  KEY `idx_resume_id` (`resume_id`),
  CONSTRAINT `fk_education_resume` FOREIGN KEY (`resume_id`) REFERENCES `resume` (`resume_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 10.5. career (경력)

```sql
CREATE TABLE `career` (
  `career_id` BIGINT NOT NULL AUTO_INCREMENT,
  `resume_id` BIGINT NOT NULL,
  `company_name` VARCHAR(100) NOT NULL,
  `position` VARCHAR(100) NOT NULL,
  `employment_period` VARCHAR(50) DEFAULT NULL,
  `is_current` BOOLEAN NOT NULL DEFAULT FALSE,
  `responsibilities` TEXT DEFAULT NULL,
  `achievements` TEXT DEFAULT NULL,
  `order_index` INT NOT NULL DEFAULT 0,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`career_id`),
  KEY `idx_resume_id` (`resume_id`),
  CONSTRAINT `fk_career_resume` FOREIGN KEY (`resume_id`) REFERENCES `resume` (`resume_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 10.6. cover_letter (자기소개서)

```sql
CREATE TABLE `cover_letter` (
  `cover_letter_id` BIGINT NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL,
  `title` VARCHAR(100) NOT NULL,
  `content` TEXT NOT NULL,
  `company_name` VARCHAR(100) DEFAULT NULL,
  `position` VARCHAR(100) DEFAULT NULL,
  `is_default` BOOLEAN NOT NULL DEFAULT FALSE,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`cover_letter_id`),
  KEY `idx_user_id` (`user_id`),
  CONSTRAINT `fk_cover_letter_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 10.7. chatbot (챗봇)

```sql
CREATE TABLE `chatbot` (
  `chatbot_id` BIGINT NOT NULL AUTO_INCREMENT,
  `chatbot_name` VARCHAR(100) NOT NULL,
  `description` TEXT DEFAULT NULL,
  `model_style` VARCHAR(50) DEFAULT NULL,
  `tts_type` VARCHAR(50) DEFAULT NULL,
  `llm_type` VARCHAR(50) DEFAULT NULL,
  `stt_type` VARCHAR(50) DEFAULT NULL,
  `prompt_id` VARCHAR(100) DEFAULT NULL,
  `document_id` VARCHAR(100) DEFAULT NULL,
  `is_active` BOOLEAN NOT NULL DEFAULT TRUE,
  `is_public` BOOLEAN NOT NULL DEFAULT TRUE,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`chatbot_id`),
  KEY `idx_is_active_public` (`is_active`, `is_public`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 10.8. chat_room (채팅방)

```sql
CREATE TABLE `chat_room` (
  `chat_id` BIGINT NOT NULL AUTO_INCREMENT,
  `perso_session_id` VARCHAR(255) NOT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`chat_id`),
  UNIQUE KEY `uk_perso_session_id` (`perso_session_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 10.9. message (메시지)

```sql
CREATE TABLE `message` (
  `message_id` BIGINT NOT NULL AUTO_INCREMENT,
  `chat_id` BIGINT NOT NULL,
  `role` VARCHAR(20) NOT NULL,
  `content` TEXT NOT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`message_id`),
  KEY `idx_chat_id` (`chat_id`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `fk_message_chat_room` FOREIGN KEY (`chat_id`) REFERENCES `chat_room` (`chat_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 10.10. interview_feedback (면접 피드백)

```sql
CREATE TABLE `interview_feedback` (
  `feedback_id` BIGINT NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL,
  `chat_id` BIGINT DEFAULT NULL,
  `score` DECIMAL(5,2) NOT NULL,
  `feedback_summary` TEXT DEFAULT NULL,
  `interview_type` VARCHAR(100) DEFAULT '일반 면접',
  `interview_date` DATETIME NOT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`feedback_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_interview_date` (`interview_date`),
  KEY `idx_user_interview` (`user_id`, `interview_date`),
  KEY `idx_interview_type` (`interview_type`),
  CONSTRAINT `fk_interview_feedback_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`),
  CONSTRAINT `fk_interview_feedback_chat` FOREIGN KEY (`chat_id`) REFERENCES `chat_room` (`chat_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 10.11. 전체 스크립트 실행 순서

외래 키 제약조건을 고려한 테이블 생성 순서:

1. `user` (부모 테이블)
2. `refresh_tokens` (user 참조)
3. `resume` (user 참조)
4. `education` (resume 참조)
5. `career` (resume 참조)
6. `cover_letter` (user 참조)
7. `chatbot` (독립 테이블)
8. `chat_room` (독립 테이블)
9. `message` (chat_room 참조)
10. `interview_feedback` (user, chat_room 참조)

---

**문서 변경 이력**

| 버전 | 날짜 | 작성자 | 변경 내용 |
| :---: | :---: | :---: | :---: |
| 1.0 | 2025.11.27 | Claude | 최초 작성 |
| 1.1 | 2025.11.28 | Claude | interview_feedback 테이블에 interview_type 컬럼 추가 (면접 종류별 필터링 기능) |

---

**문서 끝**
