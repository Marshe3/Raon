#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
초기 시드 데이터 생성 스크립트
실행: python seed_data.py
"""

import sys
import requests
import json

# Windows 콘솔 UTF-8 인코딩 설정
if sys.platform == 'win32':
    import io
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
    sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8')

RAG_SERVER_URL = "http://localhost:8000"

# 우수 답변 예시 50개
SEED_DATA = [
    # 팀워크 / 갈등 해결 (10개)
    {
        "question": "팀 프로젝트에서 갈등을 해결한 경험이 있나요?",
        "answer": "백엔드 개발 중 API 설계 방식으로 팀원과 의견 충돌이 있었습니다. 저는 RESTful 방식을 주장했고 동료는 GraphQL을 선호했습니다. 양측 장단점을 문서화하고, 프로토타입을 각각 2일간 개발해 성능 테스트를 진행했습니다. 결과적으로 우리 서비스의 단순한 CRUD 특성상 RESTful이 더 적합하다는 데이터를 제시하여 합의했고, 이후 GraphQL의 장점은 차기 프로젝트에 반영하기로 했습니다.",
        "score": 95,
        "category": "팀워크"
    },
    {
        "question": "팀원과 의견이 충돌했던 경험을 말해주세요.",
        "answer": "웹 개발 프로젝트에서 5명의 팀원 중 2명이 프론트엔드 프레임워크 선택으로 의견이 나뉘었습니다. 저는 React를 선호했고 다른 팀원은 Vue를 원했습니다. 2일간 각각 프로토타입을 만들어 성능과 학습곡선을 비교했고, 최종적으로 팀원 전체가 익숙한 React를 선택했습니다. 결과적으로 3주 만에 프로젝트를 완성하고 A학점을 받았습니다.",
        "score": 92,
        "category": "팀워크"
    },
    {
        "question": "협업 중 어려웠던 점은 무엇인가요?",
        "answer": "4명이서 진행한 모바일 앱 프로젝트에서 커밋 컨벤션이 통일되지 않아 코드 리뷰가 어려웠습니다. 제가 Git 컨벤션 문서를 작성하고 pre-commit hook을 설정해 자동으로 검증하도록 했습니다. 이후 코드 리뷰 시간이 30% 단축되었고, 버그 발견율도 개선되었습니다.",
        "score": 88,
        "category": "팀워크"
    },
    {
        "question": "팀에서 리더 역할을 맡았던 경험이 있나요?",
        "answer": "캡스톤 프로젝트에서 6명 팀의 리더를 맡았습니다. 매주 월요일 30분 스탠드업 미팅으로 진행 상황을 공유하고, Jira로 태스크를 관리했습니다. 중간에 2명이 학업 부담으로 참여가 어려워졌을 때, 업무를 재분배하고 주 2회 페어 프로그래밍으로 지식 공유를 강화했습니다. 최종적으로 학과 우수작으로 선정되었습니다.",
        "score": 94,
        "category": "리더십"
    },
    {
        "question": "팀원의 실수를 어떻게 처리했나요?",
        "answer": "팀 프로젝트에서 후배가 데이터베이스 마이그레이션을 잘못 실행해 개발 서버 데이터가 날아간 적이 있습니다. 즉시 백업에서 복구하고, 비난 대신 '왜 이런 실수가 발생했는지' 원인을 함께 분석했습니다. 이후 마이그레이션 체크리스트를 만들고, Staging 환경을 추가해 실수를 방지했습니다. 해당 후배는 이후 더 신중해졌고, 같은 실수가 재발하지 않았습니다.",
        "score": 91,
        "category": "팀워크"
    },

    # 문제 해결 / 기술 역량 (10개)
    {
        "question": "기술적으로 어려운 문제를 해결한 경험을 말해주세요.",
        "answer": "데이터베이스 쿼리 성능이 10초 이상 걸리는 문제가 있었습니다. EXPLAIN 명령어로 실행 계획을 분석한 결과 인덱스 부재가 원인이었고, 적절한 복합 인덱스 3개를 추가하여 응답 시간을 0.3초로 개선했습니다. 추가로 Redis 캐싱을 도입해 반복 쿼리는 50ms 이내로 단축했습니다.",
        "score": 96,
        "category": "기술역량"
    },
    {
        "question": "성능 최적화 경험이 있나요?",
        "answer": "React 웹 앱의 초기 로딩 시간이 8초로 느렸습니다. Webpack Bundle Analyzer로 분석한 결과 lodash 전체가 번들에 포함되어 있었습니다. Tree-shaking을 적용하고, Code Splitting으로 라우트별 lazy loading을 구현했습니다. 결과적으로 초기 번들 크기를 2.3MB에서 600KB로 줄이고, 로딩 시간을 2.5초로 단축했습니다.",
        "score": 93,
        "category": "기술역량"
    },
    {
        "question": "예상치 못한 버그를 어떻게 해결했나요?",
        "answer": "프로덕션에서 특정 사용자만 로그인이 안 되는 버그가 발생했습니다. 로그를 분석한 결과 이메일에 '+' 기호가 포함된 경우 URL 인코딩 문제로 실패하는 것을 발견했습니다. encodeURIComponent를 제대로 적용하지 않은 게 원인이었습니다. 즉시 수정하고, 엣지 케이스 테스트를 20개 추가해 재발을 방지했습니다.",
        "score": 89,
        "category": "문제해결"
    },
    {
        "question": "새로운 기술을 빠르게 학습한 경험이 있나요?",
        "answer": "프로젝트에서 Docker를 처음 사용하게 되었습니다. 공식 문서를 2일간 학습하고, 간단한 Node.js 앱을 컨테이너화하는 실습을 진행했습니다. 이후 팀 프로젝트에 Docker Compose를 도입해 개발 환경 설정 시간을 2시간에서 5분으로 단축했고, 팀원들에게 튜토리얼 세션도 진행했습니다.",
        "score": 87,
        "category": "학습능력"
    },
    {
        "question": "레거시 코드를 리팩토링한 경험이 있나요?",
        "answer": "인턴십에서 3년 된 레거시 코드를 맡았습니다. 2000줄짜리 God Class가 있었고, 테스트 커버리지가 15%였습니다. 먼저 핵심 로직에 단위 테스트 50개를 작성한 후, SRP 원칙에 따라 10개 클래스로 분리했습니다. 리팩토링 후 테스트 커버리지 80%, 버그 발생률 60% 감소, 코드 가독성이 크게 개선되었습니다.",
        "score": 95,
        "category": "기술역량"
    },

    # 실패 / 학습 경험 (10개)
    {
        "question": "가장 큰 실패 경험과 그로부터 배운 점을 말해주세요.",
        "answer": "팀 프로젝트에서 리더를 맡았는데, 코드 리뷰를 소홀히 하면서 마감 2일 전 치명적인 버그가 발견됐습니다. 밤을 새워 수정했지만 발표 퀄리티가 떨어졌고 B학점을 받았습니다. 이후로는 매일 30분 코드 리뷰 시간을 확보하고, CI/CD 파이프라인에 자동 테스트를 도입했습니다. 현재 인턴십에서는 이 경험 덕분에 버그를 사전에 3건이나 방지했습니다.",
        "score": 92,
        "category": "실패극복"
    },
    {
        "question": "프로젝트가 실패한 경험이 있나요?",
        "answer": "창업 동아리에서 6개월간 소셜 네트워크 앱을 개발했지만, 출시 1개월 만에 사용자 10명으로 실패했습니다. 원인을 분석한 결과 사용자 리서치 없이 기능 개발에만 집중한 게 문제였습니다. 이후 프로젝트에서는 MVP를 먼저 만들어 50명에게 테스트하고, 피드백을 반영하는 방식으로 전환했습니다. 결과적으로 다음 프로젝트는 300명 사용자를 확보했습니다.",
        "score": 90,
        "category": "실패극복"
    },
    {
        "question": "마감을 못 맞춰본 경험이 있나요?",
        "answer": "알고리즘 과제를 제출일 밤 11시에 시작했다가 못 맞췄습니다. 문제를 과소평가한 게 원인이었습니다. 이후 모든 과제와 프로젝트는 마감일 3일 전을 목표로 설정하고, 일정 관리에 버퍼를 30% 추가하는 습관을 들였습니다. 이후 3년간 단 한 번도 마감을 놓치지 않았습니다.",
        "score": 86,
        "category": "시간관리"
    },
    {
        "question": "비판을 받았을 때 어떻게 대응했나요?",
        "answer": "코드 리뷰에서 '변수명이 너무 짧고 의미가 불명확하다'는 피드백을 받았습니다. 처음엔 기분이 나빴지만, 실제로 1주일 후 제 코드를 이해하기 어려웠습니다. 이후 Clean Code를 읽고 변수명 규칙을 정립했습니다. 6개월 후 같은 리뷰어에게 '코드가 읽기 쉬워졌다'는 칭찬을 받았습니다.",
        "score": 88,
        "category": "성장마인드"
    },
    {
        "question": "기술 선택을 잘못한 경험이 있나요?",
        "answer": "프로젝트에서 MongoDB를 선택했는데, 복잡한 관계형 쿼리가 필요해 성능 문제가 발생했습니다. 중간에 PostgreSQL로 마이그레이션하는 데 2주가 소요되었습니다. 이후로는 프로젝트 시작 전 요구사항을 명확히 분석하고, 각 기술의 장단점을 팀과 토론하는 과정을 거칩니다. 기술 선택 실수율이 90% 감소했습니다.",
        "score": 87,
        "category": "기술선택"
    },

    # 자기소개 / 강점 (10개)
    {
        "question": "본인의 가장 큰 강점은 무엇인가요?",
        "answer": "제 강점은 문제를 체계적으로 분석하는 능력입니다. 알고리즘 대회에서 상위 5% 안에 들었고, 복잡한 버그도 로그 분석과 디버깅으로 평균 2시간 내에 해결합니다. 최근 인턴십에서 2주간 미해결된 메모리 누수 문제를 Heap Profiler로 3시간 만에 찾아내 해결했습니다.",
        "score": 91,
        "category": "강점"
    },
    {
        "question": "왜 개발자가 되고 싶나요?",
        "answer": "고등학교 때 작은 웹사이트를 만들어 200명이 사용하는 걸 보고 '코드로 사람들에게 가치를 줄 수 있다'는 사실에 감동받았습니다. 이후 4년간 10개 프로젝트를 진행하며 확신이 들었습니다. 특히 배달 앱 프로젝트에서 어르신들이 '사용하기 쉽다'고 말씀하실 때 보람을 느꼈습니다. 앞으로도 기술로 사회 문제를 해결하고 싶습니다.",
        "score": 89,
        "category": "동기부여"
    },
    {
        "question": "본인을 한 단어로 표현하면?",
        "answer": "'꾸준함'입니다. 3년간 매일 1개 이상 알고리즘 문제를 풀어 총 1,200문제를 해결했습니다. GitHub 잔디도 2년간 단 한 번도 끊기지 않았습니다. 작은 목표를 매일 달성하는 습관이 결국 큰 성과로 이어진다고 믿습니다.",
        "score": 85,
        "category": "자기소개"
    },
    {
        "question": "우리 회사에 지원한 이유는 무엇인가요?",
        "answer": "귀사의 기술 블로그를 2년간 구독하며 '마이크로서비스 전환기' 시리즈에 깊은 인상을 받았습니다. 특히 장애 대응 사례에서 투명한 커뮤니케이션과 기술적 도전 정신이 느껴졌습니다. 저도 대규모 시스템을 설계하고 운영하는 경험을 쌓고 싶어 지원했습니다. 인턴십에서 배운 Docker와 Kubernetes 경험을 귀사에서 발전시키고 싶습니다.",
        "score": 93,
        "category": "지원동기"
    },
    {
        "question": "5년 후 자신의 모습은 어떨 것 같나요?",
        "answer": "5년 후에는 백엔드 시니어 엔지니어로서 팀을 리드하고 싶습니다. 기술적으로는 분산 시스템과 대용량 트래픽 처리 전문가가 되고, 후배 개발자들을 멘토링하는 역할도 하고 싶습니다. 또한 사내 기술 세미나를 주도하고, 오픈소스 컨트리뷰션도 꾸준히 이어가고 싶습니다.",
        "score": 84,
        "category": "비전"
    },

    # 학습 / 자기계발 (10개)
    {
        "question": "최근에 배운 기술이나 지식은 무엇인가요?",
        "answer": "최근 3개월간 Kubernetes를 학습했습니다. Udemy 강의를 완강하고, 개인 프로젝트를 GKE에 배포했습니다. Deployment, Service, Ingress 설정을 익혔고, Auto Scaling까지 적용했습니다. 학습 과정을 블로그에 5편의 글로 정리했고, 총 3,000명이 읽었습니다.",
        "score": 90,
        "category": "학습능력"
    },
    {
        "question": "어떻게 기술 트렌드를 따라가나요?",
        "answer": "매일 아침 30분 Hacker News와 개발 블로그를 읽습니다. 주말에는 새로운 기술을 작은 프로젝트로 실습합니다. 최근 6개월간 Next.js, Prisma, tRPC를 학습해 풀스택 프로젝트를 완성했습니다. 또한 매달 기술 세미나 1개 이상 참석하고, 배운 내용을 팀원들과 공유합니다.",
        "score": 88,
        "category": "학습능력"
    },
    {
        "question": "좋아하는 기술 블로그나 책이 있나요?",
        "answer": "Martin Fowler 블로그와 카카오 테크 블로그를 즐겨 읽습니다. 책으로는 'Clean Code', 'Designing Data-Intensive Applications'가 가장 도움이 되었습니다. 특히 DDIA는 3번 읽으며 분산 시스템 설계 원칙을 배웠습니다. 중요한 내용은 노션에 정리해 수시로 복습합니다.",
        "score": 86,
        "category": "학습태도"
    },
    {
        "question": "개발 외에 어떤 취미가 있나요?",
        "answer": "달리기를 즐깁니다. 매주 3회 10km를 뛰며 문제 해결 아이디어를 많이 얻습니다. 작년에는 하프 마라톤을 완주했습니다. 꾸준한 운동이 집중력과 체력 향상에 도움이 되어 개발 생산성도 20% 올랐습니다.",
        "score": 82,
        "category": "취미"
    },
    {
        "question": "오픈소스 기여 경험이 있나요?",
        "answer": "React Query 문서 오타를 수정한 작은 PR부터 시작했습니다. 이후 TypeScript 타입 정의를 개선하는 PR을 보냈고, 메인테이너 리뷰를 받아 머지되었습니다. 현재는 작은 라이브러리의 컨트리뷰터로 활동하며 이슈 5개를 해결했습니다. 오픈소스를 통해 코드 리뷰 문화와 협업 방식을 많이 배웠습니다.",
        "score": 94,
        "category": "오픈소스"
    },

    # 추가 다양한 질문 (10개)
    {
        "question": "압박감을 어떻게 관리하나요?",
        "answer": "마감이 촉박한 프로젝트에서 업무를 작은 단위로 쪼개고 우선순위를 정합니다. 포모도로 기법으로 25분 집중, 5분 휴식을 반복하며 번아웃을 예방합니다. 스트레스가 심할 땐 30분 산책으로 기분 전환합니다. 이 방식으로 2주간 100시간 작업해도 집중력을 유지했습니다.",
        "score": 87,
        "category": "스트레스관리"
    },
    {
        "question": "고객이나 사용자와 소통한 경험이 있나요?",
        "answer": "캡스톤 프로젝트에서 지역 카페 사장님 5분을 인터뷰해 예약 시스템을 개발했습니다. 프로토타입을 2주마다 보여드리고 피드백을 받았습니다. '버튼이 너무 작다', '색상이 눈에 안 띈다' 등 실제 사용 불편함을 개선했습니다. 최종적으로 3개 카페에서 실제로 사용하고 만족도 4.5/5를 받았습니다.",
        "score": 91,
        "category": "고객지향"
    },
    {
        "question": "멀티태스킹을 어떻게 하나요?",
        "answer": "동시에 여러 작업을 하기보다, 하나에 집중하고 빠르게 전환하는 방식을 선호합니다. 긴급도-중요도 매트릭스로 우선순위를 정하고, 하루 3개 핵심 작업만 선택합니다. 회의나 코드 리뷰는 오후에 몰아서 처리하고, 오전은 Deep Work 시간으로 확보합니다.",
        "score": 85,
        "category": "시간관리"
    },
    {
        "question": "데이터 기반 의사결정 경험이 있나요?",
        "answer": "웹사이트 개편 시 Google Analytics로 사용자 행동을 분석했습니다. 첫 페이지 이탈률이 60%로 높아 히트맵 도구로 확인한 결과, CTA 버튼이 스크롤 아래에 있었습니다. 버튼 위치를 변경하고 A/B 테스트를 진행한 결과, 전환율이 35% 증가했습니다.",
        "score": 92,
        "category": "데이터분석"
    },
    {
        "question": "보안 관련 경험이 있나요?",
        "answer": "OWASP Top 10을 학습하고 프로젝트에 적용했습니다. SQL Injection 방지를 위해 Prepared Statement를 사용하고, XSS 방지를 위해 입력값을 sanitize했습니다. 또한 JWT 인증에 Refresh Token을 도입하고, HTTPS를 필수로 설정했습니다. 보안 체크리스트를 만들어 배포 전 항상 검토합니다.",
        "score": 89,
        "category": "보안"
    },
]

def add_example(data):
    """예시 추가"""
    try:
        response = requests.post(
            f"{RAG_SERVER_URL}/add",
            json=data,
            timeout=30
        )
        if response.status_code == 200:
            result = response.json()
            print(f"✅ [{data['category']}] {data['question'][:40]}... (점수: {data['score']})")
            return True
        else:
            print(f"❌ 추가 실패: {response.status_code}")
            return False
    except Exception as e:
        print(f"❌ 에러: {e}")
        return False

def main():
    print("=" * 80)
    print("🌱 RAG 서버 초기 데이터 추가")
    print("=" * 80)

    # 헬스 체크
    try:
        response = requests.get(f"{RAG_SERVER_URL}/health", timeout=5)
        if response.status_code == 200:
            health = response.json()
            print(f"✅ RAG 서버 연결 성공 (현재 {health['collection_count']}개 데이터)")
        else:
            print("❌ RAG 서버 연결 실패")
            return
    except Exception as e:
        print(f"❌ RAG 서버에 연결할 수 없습니다: {e}")
        print("먼저 RAG 서버를 실행하세요: python rag_server.py")
        return

    print(f"\n📊 {len(SEED_DATA)}개의 우수 답변 예시를 추가합니다...\n")

    success_count = 0
    for i, data in enumerate(SEED_DATA, 1):
        print(f"[{i}/{len(SEED_DATA)}] ", end="")
        if add_example(data):
            success_count += 1

    print("\n" + "=" * 80)
    print(f"✅ 완료! {success_count}/{len(SEED_DATA)}개 추가됨")
    print("=" * 80)

    # 최종 통계
    try:
        response = requests.get(f"{RAG_SERVER_URL}/stats", timeout=5)
        if response.status_code == 200:
            stats = response.json()
            print(f"\n📊 최종 통계: {stats['total_examples']}개 저장됨")
    except:
        pass

if __name__ == "__main__":
    main()
